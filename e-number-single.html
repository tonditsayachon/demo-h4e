<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายละเอียดสาร</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="assets/images/logo-h4e.svg" type="image/svg+xml">
    <style>
        /* Additional styles for single page */
        .single-content {
            padding: 40px 0;
        }

        .detail-card {
            background-color: var(--card-bg-color);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color);
            margin-bottom: 40px;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .distributor-list {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .distributor-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .distributor-item:hover {
            background-color: var(--bg-color);
        }

        .distributor-item img {
            height: 50px;
            width: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .distributor-item span {
            font-weight: 500;
        }
    </style>
</head>

<body>

    <header class="top-bar">
        <div class="container top-bar-container">
            <a href="index.html" class="logo">
                <img src="assets/images/h4e-logo.png" alt="H4E Logo">
            </a>
            <nav class="top-nav">
                <a href="distributors.html" class="nav-link">ผู้จัดจำหน่าย</a>
                <button id="lang-switcher-btn" class="icon-btn" title="เปลี่ยนภาษา">TH/EN</button>
                <button id="dark-mode-toggle" class="icon-btn" title="โหมดกลางวัน/กลางคืน">☀️</button>
            </nav>
        </div>
    </header>

    <div class="container single-content">
        <div class="detail-card">
            <div class="detail-header">
                <div>
                    <h1 id="e-number-title" style="margin:0;">-</h1>
                    <p id="e-number-name" style="margin:0; font-size: 1.2em; opacity: 0.8;"></p>
                </div>
                <span id="e-number-status" class="status">-</span>
            </div>

            <div class="detail-body">
                <h3>รายละเอียด</h3>
                <p>Additive Type: <strong id="e-number-type">-</strong></p>
                <p>Sub Additive Type: <strong id="e-number-sub-type">-</strong></p>
                <p>คำอธิบาย: ส่วนนี้เป็นพื้นที่สำหรับคำอธิบายเพิ่มเติม...</p>
            </div>
        </div>

        <div class="detail-card">
            <h3>ผู้จัดจำหน่ายที่ใช้งานสารนี้ (<span id="distributor-count">0</span>)</h3>
            <ul id="distributor-list">
            </ul>
        </div>
    </div>

    <footer class="site-footer">
    </footer>

    <script src="js/mock-data.js"></script>
    <script>
        // JS สำหรับหน้านี้โดยเฉพาะ
        document.addEventListener('DOMContentLoaded', () => {
            // ในเว็บจริง จะดึง ID จาก URL parameter e.g., ?id=E100
            // ใน Demo นี้ เราจะใช้ hash #E100 เพื่อความง่าย
            const eNumberId = window.location.hash.substring(1);
            if (!eNumberId) {
                // Handle case where no ID is provided
                document.getElementById('e-number-title').innerText = "ไม่พบข้อมูล";
                return;
            }

            const eNumber = eNumbersData.find(e => e.id === eNumberId);
            if (!eNumber) {
                document.getElementById('e-number-title').innerText = "ไม่พบข้อมูลสาร " + eNumberId;
                return;
            }

            // --- Populate E-Number Details ---
            // e-number-single.html -> ภายใน <script>

            // --- Populate E-Number Details ---
            document.getElementById('e-number-title').innerText = eNumber.id;
            document.getElementById('e-number-name').innerText = eNumber.name;
            document.getElementById('e-number-type').innerText = eNumber.type;

            const statusInfo = {
                'halal-cert': { text: 'ฮาลาล (รับรอง)', className: 'halal-cert' },
                'halal-fatwa': { text: 'ฮาลาล (ฟัตวา)', className: 'halal-fatwa' },
                'mashbooh': { text: 'มัชบูฮ์', className: 'mashbooh' }
            }[eNumber.status] || { text: 'ไม่ระบุ', className: 'unidentified' };

            const statusEl = document.getElementById('e-number-status');
            statusEl.textContent = statusInfo.text;
            statusEl.className = `status ${statusInfo.className}`;

            // --- Populate Distributor List ---
            const distributorListEl = document.getElementById('distributor-list');
            const distributorCountEl = document.getElementById('distributor-count');
            const usedByDistributors = distributorsData.filter(d => eNumber.usedBy.includes(d.id));

            distributorCountEl.innerText = usedByDistributors.length;

            if (usedByDistributors.length === 0) {
                distributorListEl.innerHTML = '<li>ไม่พบข้อมูลโรงงานที่ใช้งานสารนี้</li>';
            } else {
                usedByDistributors.forEach(distributor => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <a href="distributor-single.html#${distributor.id}" class="distributor-item">
                            <img src="${distributor.logo}" alt="${distributor.name} Logo">
                            <span>${distributor.name}</span>
                        </a>
                    `;
                    distributorListEl.appendChild(li);
                });
            }
        });
    </script>
</body>

</html>